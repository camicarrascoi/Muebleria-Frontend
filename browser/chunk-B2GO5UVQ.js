import{a as H,b as S,c as Y,d as J}from"./chunk-B5OUWNTN.js";import{$a as P,Aa as w,Bb as A,Cb as L,Da as _,Db as X,Eb as D,Fb as W,Gb as B,Hb as z,Ib as j,Jb as q,Ka as m,Kb as G,La as a,Lb as R,Ma as i,Oa as g,Pa as f,Qa as s,Ra as b,Sa as l,Ta as x,Va as E,X as p,Xa as v,Y as u,Ya as h,Za as C,_a as M,ab as k,d as U,pb as O,qb as F,ra as d,rb as I,sb as T,tb as N,va as V}from"./chunk-CQMFC4HS.js";var Q=U(Y());function Z(r,n){if(r&1){let e=g();a(0,"button",8),f("click",function(){p(e);let o=s();return u(o.abrirFormularioNuevo())}),l(1,"\u2795 Agregar venta"),i()}}function $(r,n){r&1&&(a(0,"th"),l(1,"Acciones"),i())}function ee(r,n){if(r&1&&(a(0,"li"),l(1),i()),r&2){let e=n.$implicit;d(),E(" ",e.nombre," (Cantidad: ",e.cantidad,") ")}}function te(r,n){if(r&1){let e=g();a(0,"td")(1,"button",8),f("click",function(){p(e);let o=s().$implicit,t=s(2);return u(t.editarVenta(o))}),l(2,"\u270F\uFE0F Editar"),i(),a(3,"button",8),f("click",function(){p(e);let o=s().$implicit,t=s(2);return u(t.eliminarVenta(o.id))}),l(4,"\u{1F5D1}\uFE0F Eliminar"),i()()}}function ne(r,n){if(r&1&&(a(0,"tr")(1,"td"),l(2),M(3,"date"),i(),a(4,"td"),l(5),M(6,"currency"),i(),a(7,"td")(8,"ul"),_(9,ee,2,2,"li",11),i()(),_(10,te,5,0,"td",10),i()),r&2){let e=n.$implicit,c=s(2);d(2),x(P(3,4,e.fecha,"dd/MM/yyyy")),d(3),x(k(6,7,e.total,"CLP","symbol")),d(4),m("ngForOf",e.ventaMuebles),d(),m("ngIf",c.esAdmin)}}function ie(r,n){if(r&1&&(a(0,"table",9)(1,"thead")(2,"tr")(3,"th"),l(4,"Fecha"),i(),a(5,"th"),l(6,"Total"),i(),a(7,"th"),l(8,"Muebles Vendidos"),i(),_(9,$,2,0,"th",10),i()(),a(10,"tbody"),_(11,ne,11,11,"tr",11),i()()),r&2){let e=s();d(9),m("ngIf",e.esAdmin),d(2),m("ngForOf",e.ventas)}}function oe(r,n){r&1&&(a(0,"div",24),l(1," La fecha es obligatoria. "),i())}function ae(r,n){r&1&&(a(0,"div",24),l(1," El total es obligatorio y debe ser positivo. "),i())}function re(r,n){if(r&1){let e=g();a(0,"div",12)(1,"h3"),l(2),i(),a(3,"form",13,0),f("ngSubmit",function(){p(e);let o=s();return u(o.guardarVenta())}),a(5,"label",14),l(6,"Fecha:"),i(),a(7,"input",15,1),C("ngModelChange",function(o){p(e);let t=s();return h(t.ventaSeleccionada.fecha,o)||(t.ventaSeleccionada.fecha=o),u(o)}),i(),_(9,oe,2,0,"div",16),a(10,"label",17),l(11,"Total (CLP):"),i(),a(12,"input",18,2),C("ngModelChange",function(o){p(e);let t=s();return h(t.ventaSeleccionada.total,o)||(t.ventaSeleccionada.total=o),u(o)}),i(),_(14,ae,2,0,"div",16),a(15,"label",19),l(16,"Muebles vendidos (IDs separados por coma):"),i(),a(17,"input",20),C("ngModelChange",function(o){p(e);let t=s();return h(t.ventaMueblesSeleccionados,o)||(t.ventaMueblesSeleccionados=o),u(o)}),i(),a(18,"div",21)(19,"button",22),l(20,"Guardar"),i(),a(21,"button",23),f("click",function(){p(e);let o=s();return u(o.cancelarFormulario())}),l(22,"Cancelar"),i()()()()}if(r&2){let e=b(4),c=b(8),o=b(13),t=s();d(2),x(t.ventaSeleccionada!=null&&t.ventaSeleccionada.id?"Editar Venta":"Agregar Venta"),d(5),v("ngModel",t.ventaSeleccionada.fecha),d(2),m("ngIf",c.invalid&&c.touched),d(3),v("ngModel",t.ventaSeleccionada.total),d(2),m("ngIf",o.invalid&&o.touched),d(3),v("ngModel",t.ventaMueblesSeleccionados),d(2),m("disabled",e.invalid)}}var K=class r{constructor(n,e){this.ventaService=n;this.authService=e}ventas=[];ventaSeleccionada=null;ventaMueblesSeleccionados="";mostrarFormulario=!1;esAdmin=!0;ngOnInit(){this.cargarVentas()}cargarVentas(){this.ventaService.obtenerVentas().subscribe({next:n=>{this.ventas=n},error:n=>{console.error("Error al cargar ventas:",n)}})}abrirFormularioNuevo(){this.ventaSeleccionada={fecha:"",total:0,ventaMuebles:[]},this.ventaMueblesSeleccionados="",this.mostrarFormulario=!0}editarVenta(n){this.ventaSeleccionada={id:n.id,fecha:n.fecha,total:n.total,ventaMuebles:[...n.ventaMuebles]},this.ventaMueblesSeleccionados=n.ventaMuebles.map(e=>e.id).join(","),this.mostrarFormulario=!0}eliminarVenta(n){confirm("\xBFSeguro que deseas eliminar esta venta?")&&this.ventaService.eliminarVenta(n).subscribe({next:()=>this.cargarVentas(),error:e=>console.error("Error al eliminar:",e)})}cancelarFormulario(){this.ventaSeleccionada=null,this.mostrarFormulario=!1}guardarVenta(){if(!this.ventaSeleccionada)return;let e=this.ventaMueblesSeleccionados.split(",").map(t=>Number(t.trim())).filter(t=>!isNaN(t)).map(t=>({id:t,nombre:"",cantidad:1}));this.ventaSeleccionada.ventaMuebles=e,(!this.ventaSeleccionada.id?this.ventaService.crearVenta(this.ventaSeleccionada):this.ventaService.editarVenta(this.ventaSeleccionada)).subscribe({next:()=>{this.cargarVentas(),this.cancelarFormulario()},error:t=>console.error("Error al guardar venta:",t)})}exportarVentasExcel(){let n=S.json_to_sheet(this.ventas.map(t=>({Fecha:t.fecha,Total:t.total,MueblesVendidos:t.ventaMuebles.map(y=>`${y.nombre} (x${y.cantidad})`).join(", ")}))),e=S.book_new();S.book_append_sheet(e,n,"Ventas");let c=H(e,{bookType:"xlsx",type:"array"}),o=new Blob([c],{type:"application/octet-stream"});(0,Q.saveAs)(o,"ventas.xlsx")}static \u0275fac=function(e){return new(e||r)(V(J),V(R))};static \u0275cmp=w({type:r,selectors:[["app-venta"]],decls:7,vars:3,consts:[["formVenta","ngForm"],["fecha","ngModel"],["total","ngModel"],[1,"navbar"],[1,"acciones"],[3,"click",4,"ngIf"],["border","1",4,"ngIf"],["class","formulario-venta",4,"ngIf"],[3,"click"],["border","1"],[4,"ngIf"],[4,"ngFor","ngForOf"],[1,"formulario-venta"],["novalidate","",3,"ngSubmit"],["for","fecha"],["id","fecha","name","fecha","type","date","required","",3,"ngModelChange","ngModel"],["class","error",4,"ngIf"],["for","total"],["id","total","name","total","type","number","required","","min","0",3,"ngModelChange","ngModel"],["for","ventaMuebles"],["id","ventaMuebles","name","ventaMuebles","type","text","placeholder","1,3,5",3,"ngModelChange","ngModel"],[1,"botones-formulario"],["type","submit",3,"disabled"],["type","button",3,"click"],[1,"error"]],template:function(e,c){e&1&&(a(0,"nav",3)(1,"span"),l(2,"Lista Ventas"),i()(),a(3,"div",4),_(4,Z,2,0,"button",5),i(),_(5,ie,12,2,"table",6)(6,re,23,7,"div",7)),e&2&&(d(4),m("ngIf",c.esAdmin),d(),m("ngIf",c.ventas.length>0),d(),m("ngIf",c.mostrarFormulario))},dependencies:[N,O,F,T,I,G,B,A,z,L,X,q,j,W,D],styles:["[_nghost-%COMP%]{display:block;background-color:#fdf6e3;padding:20px;font-family:Arial,sans-serif;font-size:18px;color:#333}.navbar[_ngcontent-%COMP%]{background-color:#8b5e3c;color:#fff;padding:15px 20px;font-size:22px;font-weight:700;border-radius:8px;margin-bottom:20px}.acciones[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:#a86f4c;color:#fff;border:none;padding:12px 20px;font-size:18px;border-radius:6px;cursor:pointer;margin-bottom:20px}.acciones[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#935e3f}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;margin-bottom:20px}thead[_ngcontent-%COMP%]{background-color:wheat;color:#333;font-weight:700}td[_ngcontent-%COMP%], th[_ngcontent-%COMP%]{border:1px solid #ddd;padding:12px;text-align:left}tr[_ngcontent-%COMP%]:nth-child(2n){background-color:#fff8ee}td[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:#8b5e3c;color:#fff;border:none;padding:8px 12px;margin-right:5px;font-size:16px;border-radius:5px;cursor:pointer}td[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#6f442a}form[_ngcontent-%COMP%]{background-color:#fff4e6;padding:20px;border-radius:8px;max-width:600px;margin:20px auto;box-shadow:0 4px 8px #0000001a}form[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:15px;font-weight:700}form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;box-sizing:border-box;padding:10px;font-size:16px;margin-top:5px;border-radius:4px;border:1px solid #ccc}form[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:#4caf50;color:#fff;border:none;padding:10px 18px;font-size:16px;border-radius:6px;margin-right:10px;cursor:pointer}form[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#45a049}.error[_ngcontent-%COMP%]{color:red;font-size:14px;margin-top:-10px;margin-bottom:10px}"]})};export{K as VentaComponent};
