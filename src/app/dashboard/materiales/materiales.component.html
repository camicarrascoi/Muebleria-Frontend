<!-- Barra de navegaciÃ³n simple -->
<nav class="navbar">
  <span>Lista Materiales</span>
</nav>

<!-- BotÃ³n Agregar solo visible para admin -->
<div class="acciones">
  <button *ngIf="esAdmin" (click)="abrirFormularioNuevo()">â• Agregar material</button>
</div>

<!-- Mostrar cantidad de materiales para debugging -->
<p>Materiales cargados: {{ materiales.length }}</p>

<!-- Tabla de materiales SIN overflow-x y adaptada al ancho -->
<div class="tabla-contenedor">
  <!-- Comentado *ngIf para pruebas, lo puedes descomentar cuando estÃ© OK -->
<table *ngIf="materiales.length > 0" class="tabla-materiales">
  <thead>
    <tr>
      <th>Nombre</th>
      <th>Tipo</th>
      <th>DescripciÃ³n</th>
      <th>Unidad de Medida</th>
      <th>Stock Actual</th>
      <th>Proveedores</th>
      <th>Muebles</th>
      <th *ngIf="esAdmin">Acciones</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let material of materiales">
      <!-- QuitÃ© el id porque no quieres mostrarlo -->
      <td>{{ material.nombre }}</td>
      <td>{{ material.tipo }}</td>
      <td>{{ material.descripcion }}</td>
      <td>{{ material.unidadDeMedida }}</td>
      <td>{{ material.stockActual }}</td>
      <td>
        <ul>
          <li *ngFor="let prov of material.proveedorMateriales">
            {{ prov?.nombre || 'Sin nombre' }}
          </li>
        </ul>
      </td>
      <td>
        <ul>
          <li *ngFor="let mm of material.materialMuebles">
            {{ mm?.muebleNombre || 'Sin mueble' }}: {{ mm?.cantidadUtilizada ?? 'N/A' }}
          </li>
        </ul>
      </td>
      <td *ngIf="esAdmin">
        <div class="acciones-botones">
          <button (click)="editarMaterial(material)">âœï¸ Editar</button>
          <button (click)="eliminarMaterial(material.id!)">ğŸ—‘ï¸ Eliminar</button>
        </div>
      </td>
    </tr>
  </tbody>
</table>
</div>


<!-- Formulario para agregar/editar materiales -->
<div *ngIf="mostrarFormulario" class="formulario-material">
  <h3>{{ materialSeleccionado?.id ? 'Editar Material' : 'Agregar Material' }}</h3>
  <form #frm="ngForm" (ngSubmit)="guardarMaterial(frm)">
    <label>
      Nombre:
      <input
        type="text"
        name="nombre"
        required
        pattern="[A-Za-zÃÃ‰ÃÃ“ÃšÃ¡Ã©Ã­Ã³ÃºÃ±Ã‘ ]+"
        [(ngModel)]="materialSeleccionado!.nombre"
        (keypress)="soloLetras($event)"
        #nombre="ngModel"
      />
      <div class="error" *ngIf="nombre.invalid && nombre.touched">
        Solo letras y espacios.
      </div>
    </label>

    <label>
      Tipo:
      <select
        name="tipo"
        required
        [(ngModel)]="materialSeleccionado!.tipo"
      >
        <option *ngFor="let tipo of tiposMaterial" [value]="tipo">
          {{ tipo }}
        </option>
      </select>
    </label>

    <label>
      DescripciÃ³n:
      <input
        type="text"
        name="descripcion"
        required
        pattern="[A-Za-zÃÃ‰ÃÃ“ÃšÃ¡Ã©Ã­Ã³ÃºÃ±Ã‘ ]+"
        [(ngModel)]="materialSeleccionado!.descripcion"
        (keypress)="soloLetras($event)"
        #descripcion="ngModel"
      />
      <div class="error" *ngIf="descripcion.invalid && descripcion.touched">
        Solo letras y espacios.
      </div>
    </label>

    <label>
      Unidad de Medida:
      <input
        type="text"
        name="unidadDeMedida"
        required
        [(ngModel)]="materialSeleccionado!.unidadDeMedida"
      />
    </label>

    <label>
      Stock Actual:
      <input
        type="number"
        name="stockActual"
        required
        min="0"
        step="1"
        [(ngModel)]="materialSeleccionado!.stockActual"
        (keypress)="soloNumeros($event)"
        #stockActual="ngModel"
      />
      <div class="error" *ngIf="stockActual.invalid && stockActual.touched">
        Solo nÃºmeros enteros â‰¥ 0.
      </div>
    </label>

    <div class="botones-formulario">
      <button type="submit" [disabled]="frm.invalid">ğŸ’¾ Guardar</button>
      <button type="button" (click)="cancelarFormulario()">âŒ Cancelar</button>
    </div>
  </form>
</div>
