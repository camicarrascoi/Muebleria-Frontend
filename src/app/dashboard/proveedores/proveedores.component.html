<!-- Barra de navegaci√≥n simple -->
<nav class="navbar">
  <span>Lista Proveedores</span>
</nav>

<!-- Bot√≥n Agregar solo visible para admin -->
<div class="acciones">
  <button *ngIf="esAdmin" (click)="abrirFormularioNuevo()">‚ûï Agregar proveedor</button>
</div>

<!-- Tabla de proveedores -->
<table *ngIf="proveedores.length > 0" border="1">
  <thead>
    <tr>
      <th>Nombre</th>
      <th>Tel√©fono</th>
      <th>Correo</th>
      <th>Direcci√≥n</th>
      <th>Materiales</th>
      <th>Costo Unitario</th>
      <th *ngIf="esAdmin">Acciones</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let proveedor of proveedores">
      <td>{{ proveedor.nombre }}</td>
      <td>{{ proveedor.telefono }}</td>
      <td>{{ proveedor.correo }}</td>
      <td>{{ proveedor.direccion }}</td>
      <td>
        <ul>
          <li *ngFor="let pm of proveedor.proveedorMateriales">
            {{ pm.material.nombre }}
          </li>
        </ul>
      </td>
      <td>
        <ul>
          <li *ngFor="let pm of proveedor.proveedorMateriales">
            {{ pm.costoUnitario }}
          </li>
        </ul>
      </td>
      <td *ngIf="esAdmin">
        <button (click)="editarProveedor(proveedor)">‚úèÔ∏è Editar</button>
        <button (click)="eliminarProveedor(proveedor.id!)">üóëÔ∏è Eliminar</button>
      </td>
    </tr>
  </tbody>
</table>

<!-- Formulario agregar/editar -->
<div *ngIf="mostrarFormulario && proveedorSeleccionado">
  <h3>{{ proveedorSeleccionado.id ? 'Editar Proveedor' : 'Agregar Proveedor' }}</h3>
  <form (ngSubmit)="guardarProveedor()" #formProveedor="ngForm" novalidate>
    <!-- Datos b√°sicos -->
    <label>
      Nombre:
      <input type="text" [(ngModel)]="proveedorSeleccionado.nombre" name="nombre" required />
    </label><br />

    <label>
      Tel√©fono:
      <input type="text" [(ngModel)]="proveedorSeleccionado.telefono" name="telefono" required />
    </label><br />

    <label>
      Correo:
      <input type="email" [(ngModel)]="proveedorSeleccionado.correo" name="correo" required />
    </label><br />

    <label>
      Direcci√≥n:
      <input type="text" [(ngModel)]="proveedorSeleccionado.direccion" name="direccion" required />
    </label><br />

    <!-- Materiales -->
    <fieldset>
      <legend>Materiales que provee</legend>

      <button type="button" (click)="agregarMaterial()">‚ûï Agregar material</button>

      <div *ngFor="let pm of proveedorSeleccionado.proveedorMateriales; let i = index" style="margin-bottom:1em">
        <!-- Selecci√≥n del material -->
        <select [(ngModel)]="pm.material.id" (ngModelChange)="onMaterialChange(pm, $event)"
                name="materialId{{i}}" required>
          <option [ngValue]="undefined">-- Selecciona un material --</option>
          <option *ngFor="let mat of materialesDisponibles" [ngValue]="mat.id">
            {{ mat.nombre }}
          </option>
        </select>

        <!-- Costo unitario -->
        <input type="number" [(ngModel)]="pm.costoUnitario" name="costo{{i}}" [min]="0" required />

        <!-- Bot√≥n para quitar -->
        <button type="button" (click)="quitarMaterial(i)">üóëÔ∏è</button>
      </div>
    </fieldset>

    <button type="submit" [disabled]="formProveedor.invalid">üíæ Guardar</button>
    <button type="button" (click)="cancelarFormulario()">‚ùå Cancelar</button>
  </form>
</div>
