<!-- Header -->
<p style="color: rgb(0, 119, 255); font-weight: bold;">
  ROL: {{ esAdmin ? 'ADMIN' : esUsuario ? 'USER' : 'Desconocido' }}
</p>
<nav class="navbar">
  <span>Lista Proveedores</span>
</nav>

<div class="acciones">
  <button *ngIf="esAdmin" (click)="abrirFormularioNuevo()">‚ûï Agregar proveedor</button>
</div>

<table *ngIf="proveedores.length > 0" border="1">
  <thead>
    <tr>
      <th>Fecha de Pedido</th>
      <th>Nombre</th>
      <th>Tel√©fono</th>
      <th>Correo</th>
      <th>Direcci√≥n</th>
      <th>Materiales</th>
      <th>Costo Unitario</th>
      <th *ngIf="esAdmin">Acciones</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let proveedor of proveedores">
      <td>{{ proveedor.fechaPedido | date: 'dd/MM/yyyy' }}
      <td>{{ proveedor.nombre }}</td>
      <td>{{ proveedor.telefono }}</td>
      <td>{{ proveedor.correo }}</td>
      <td>{{ proveedor.direccion }}</td>
      <td>
        <ul>
          <li *ngFor="let pm of proveedor.proveedorMateriales">
            {{ pm.material.nombre }} ({{ pm.material.unidadDeMedida }})
          </li>
        </ul>
      </td>
      <td>
        <ul>
          <li *ngFor="let pm of proveedor.proveedorMateriales">
            {{ pm.cantidadSuministrada }} x {{ pm.costoUnitario | currency:'CLP':'symbol':'1.0-0' }}
          </li>
        </ul>
      </td>
      <td *ngIf="esAdmin">
        <div class="acciones-botones">
          <button (click)="editarProveedor(proveedor)">‚úèÔ∏è Editar</button>
          <button (click)="eliminarProveedor(proveedor.id!)">üóëÔ∏è Eliminar</button>
        </div>
      </td>
    </tr>
  </tbody>
</table>

<!-- Formulario A√±adir/Editar Proveedor -->
<div *ngIf="mostrarFormulario && proveedorSeleccionado as prov" class="formulario-proveedor">
  <h3>{{ prov.id ? 'Editar Proveedor' : 'Agregar Proveedor' }}</h3>
  <form (ngSubmit)="guardarProveedor()" #formProveedor="ngForm" novalidate>

    <!-- Campos b√°sicos del proveedor -->
    <label>
      Fecha de Pedido:
      <input type="date" [(ngModel)]="prov.fechaPedido" name="fechaPedido" required />
    </label>
    <label>
      Nombre:
      <input type="text" [(ngModel)]="prov.nombre" name="nombre" required />
    </label>
    <label>
      Tel√©fono:
      <input type="tel" [(ngModel)]="prov.telefono" name="telefono" required (keypress)="soloNumeros($event)" />
    </label>
    <label>
      Correo:
      <input type="email" [(ngModel)]="prov.correo" name="correo" required />
    </label>
    <label>
      Direcci√≥n:
      <input type="text" [(ngModel)]="prov.direccion" name="direccion" required />
    </label>

    <hr />

    <!-- Crear Materiales del proveedor -->
    <div *ngIf="!prov.id">
      <h4>Agregar materiales</h4>

      <div *ngFor="let pm of prov.proveedorMateriales; let i = index" class="material-item">
        <!-- Nombre del material -->
        <label>
          Nombre Material:
          <input type="text" [(ngModel)]="pm.material.nombre" name="matNombreNew{{i}}" required />
        </label>

        <!-- Tipo del material -->
        <label>
          Tipo:
          <select [(ngModel)]="pm.material.tipo" name="tipoMaterial{{i}}" required>
            <option value="" disabled>Seleccione tipo</option>
            <option *ngFor="let tipo of tiposMaterial" [value]="tipo">{{ tipo }}</option>
          </select>
        </label>

        <!-- Descripci√≥n -->
        <label>
          Descripci√≥n:
          <input type="text" [(ngModel)]="pm.material.descripcion" name="matDescNew{{i}}" required />
        </label>

        <!-- Unidad de medida -->
        <label>
          Unidad de Medida:
          <input type="text" [(ngModel)]="pm.material.unidadDeMedida" name="matUnidadNew{{i}}" required />
        </label>

        <!-- Stock Actual -->
        <label>
          Stock Actual:
          <input type="number" [(ngModel)]="pm.material.stockActual" name="stockActualNew{{i}}" min="0" required />
        </label>

        <!-- Costo unitario -->
        <label>
          Costo Unitario:
          <input type="number" [(ngModel)]="pm.costoUnitario" name="costoNew{{i}}" min="0" required />
        </label>

        <!-- Cantidad suministrada -->
        <label>
          Cantidad:
          <input type="number" [(ngModel)]="pm.cantidadSuministrada" name="cantidadNew{{i}}" min="1" required />
        </label>

        <div class="boton-quitar">
          <button type="button" (click)="quitarMaterial(i)">üóëÔ∏è</button>
        </div>
      </div>

      <div class="boton-agregar">
        <button type="button" (click)="agregarMaterial()">‚ûï Agregar otro material</button>
      </div>
    </div>


    <!-- Botones Guardar/Cancelar -->
    <div class="botones-formulario">
      <button type="submit" [disabled]="formProveedor.invalid">üíæ Guardar</button>
      <button type="button" (click)="cancelarFormulario()">‚ùå Cancelar</button>
    </div>

  </form>
</div>